package Exploit.org;

import javax.swing.*;
import java.io.File;
import java.util.LinkedList;
import java.util.ListIterator;
import java.util.Objects;

public class WaveFX {
    private final LinkedList<Track> trackList = new LinkedList<>();
    private final LinkedList<Album> albumList = new LinkedList<>();
    private final LinkedList<Playlist> playlistsCollection = new LinkedList<>();

    public LinkedList<Track> getTrackList() {
        return trackList;
    }

    public LinkedList<Album> getAlbumList() {
        return albumList;
    }

    public WaveFX() {
        this.extractPathAndCreateTracks();
        this.createAndStoreInAlbums();
        Favorites favorites = new Favorites();
        this.playlistsCollection.add(favorites);
    }

    private boolean extractPathAndCreateTracks() {
        File[] directory = new File("src/Exploit/org/Trackstore/Music").listFiles();
        for (int i = 0; i < Objects.requireNonNull(directory).length; i++) {
            File file = directory[i];
            if (file.isFile()) {
                Track track = new Track(file.getPath());
                this.trackList.add(track);
            }
        }
        return true;
    }

    private boolean createAndStoreInAlbums() {
        for (Track track : this.trackList) {
            ListIterator<Album> albumListIterator = this.albumList.listIterator();
            boolean isAddedToAlbum = false;
            while (albumListIterator.hasNext()) {
                if (albumListIterator.next().getAlbumName().equals(track.getTrackArtist())) {
                    albumListIterator.previous().addTrackToAlbum(track);
                    isAddedToAlbum = true;
                    break;
                }
            }
            if (!isAddedToAlbum) {
                Album album = new Album(track);
                albumListIterator.add(album);
            }
        }
        return true;
    }

    private boolean renameTrack() {
        ListIterator<Track> trackListIterator = this.trackList.listIterator();
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String response = (String) JOptionPane.showInputDialog(null,
                "Select track to rename : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                this.trackArrayList(),
                null);
        if (response == null) {
            return false;
        }
        while (trackListIterator.hasNext()) {
            if (trackListIterator.next().getTrackName().equals(response)) {
                return trackListIterator.previous().renameTheTrack();
            }
        }
        return false;
    }

    private boolean playTracksSequentially() {
        ListIterator<Track> trackListIterator = this.trackList.listIterator();
        int flag;
        boolean isGoingForward = true;
        flag = trackListIterator.next().waveFxPlayer();
        while (flag != 0) {
            if (flag == 1) {
                if (isGoingForward) {
                    if (trackListIterator.hasPrevious()) {
                        trackListIterator.previous();
                    }
                    isGoingForward = false;
                }
                if (trackListIterator.hasPrevious()) {
                    flag = trackListIterator.previous().waveFxPlayer();
                } else {
                    //This is the start of the list or Head element of the linked list.
                    flag = trackListIterator.next().waveFxPlayer();
                }
            }

            if (flag == 5) {
                if (!isGoingForward) {
                    if (trackListIterator.hasNext()) {
                        trackListIterator.next();
                    }
                    isGoingForward = true;
                }
                if (trackListIterator.hasNext()) {
                    flag = trackListIterator.next().waveFxPlayer();
                } else {
                    //This is the End of the list.
                    flag = trackListIterator.previous().waveFxPlayer();
                }
            }
            if (flag == 0) {
                return true;
            }
        }
        return false;
    }

    public boolean playSelectedTracks() {
        ListIterator<Track> trackListIterator = this.trackList.listIterator();
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String response = (String) JOptionPane.showInputDialog(null,
                "Select track to Play : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                this.trackArrayList(),
                null);
        if (response == null) {
            return false;
        }
        while (trackListIterator.hasNext()) {
            if (trackListIterator.next().getTrackName().equals(response)) {
                int flag = trackListIterator.previous().waveFxPlayer();
                if (flag == 1 || flag == 5) {
                    this.playTracksSequentially();
                }
                return true;
            }
        }
        return false;
    }

    private String[] trackArrayList() {
        String[] trackListArray = new String[this.trackList.size()];
        ListIterator<Track> playListIterator = this.trackList.listIterator();
        for (int i = 0; i < this.trackList.size(); i++) {
            trackListArray[i] = playListIterator.next().getTrackName();
        }
        return trackListArray;
    }

    private boolean removeTracks() {
        ListIterator<Track> trackListIterator = this.trackList.listIterator();
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String response = (String) JOptionPane.showInputDialog(null,
                "Select track to remove : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                this.trackArrayList(),
                null);
        if (response == null) {
            return false;
        }
        while (trackListIterator.hasNext()) {
            if (trackListIterator.next().getTrackName().equals(response)) {
                trackListIterator.remove();
                return true;
            }
        }
        return false;
    }

    private String[] albumArrayList() {
        String[] albumListArray = new String[this.albumList.size()];
        ListIterator<Album> albumListIterator = this.albumList.listIterator();
        for (int i = 0; i < this.trackList.size(); i++) {
            albumListArray[i] = albumListIterator.next().getAlbumName();
        }
        return albumListArray;
    }

    private boolean displayAvailableAlbums() {
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String response = (String) JOptionPane.showInputDialog(null,
                "Select from available albums   : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                this.albumArrayList(),
                null);
        ListIterator<Album> albumListIterator = this.albumList.listIterator();
        while (albumListIterator.hasNext()) {
            if (albumListIterator.next().getAlbumName().equals(response)) {
                return albumListIterator.previous().albumDriverCode();
            }
        }
        return false;
    }

    private boolean displayAvailableTracks() {
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String response = (String) JOptionPane.showInputDialog(null,
                "Select from available Tracks   : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                this.trackArrayList(),
                null);
        ListIterator<Track> trackListIterator = this.trackList.listIterator();
        while (trackListIterator.hasNext()) {
            if (trackListIterator.next().getTrackName().equals(response)) {
                return showOperationsOnTrack(trackListIterator.previous());
            }
        }
        return false;
    }

    private String[] playlistArray() {
        String[] playlistArray = new String[this.playlistsCollection.size() + 1];
        ListIterator<Playlist> playlistIterator = this.playlistsCollection.listIterator();
        int i = 0;
        while (i < this.playlistsCollection.size()) {
            playlistArray[i] = playlistIterator.next().getPlayListName();
            i++;
        }
        playlistArray[i] = "Create new Playlist";
        return playlistArray;
    }

    private String displayAvailablePlaylist() { //call it in driver.
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        return (String) JOptionPane.showInputDialog(null,
                "Select from available Playlists   : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                this.playlistArray(),
                null);
    }

    private Playlist createPlaylist() {
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String response = (String) JOptionPane.showInputDialog(null,
                "Enter a name for the new Playlist : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                null,
                null);
        if (response == null) {
            return null;
        }
        Playlist playlist = new Playlist(response);
        this.playlistsCollection.add(playlist);
        return playlist;
    }

    private boolean showOperationsOnPlaylist(String playlistName) { //call it in driver
        if (playlistName.equals("Create new Playlist")) {
            this.createPlaylist();
            return true;
        }
        ListIterator<Playlist> playlistIterator = this.playlistsCollection.listIterator();
        while (playlistIterator.hasNext()) {
            if (playlistIterator.next().getPlayListName().equals(playlistName)) {
                return playlistIterator.previous().playListDriverCode();
            }
        }
        return false;
    }

    private boolean showOperationsOnTrack(Track track) {
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String[] options = {"Play Track", "Add to Playlist", "Add to Favorites"};
        String response = (String) JOptionPane.showInputDialog(null,
                "Select operation to perform on Tracks : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                options,
                null);
        if (!(response == null)) {
            switch (response) {
                case "Play Track":
                    int flag = track.waveFxPlayer();
                    if (flag == 1 || flag == 5) {
                        return this.playTracksSequentially();
                    }
                    break;
                case "Add to Playlist":
                    String playlistName = this.displayAvailablePlaylist(); //return object playlist.

                    if (playlistName.equals("Create new Playlist")) {
                        Playlist playlist = this.createPlaylist(); //return object playlist.
                        if (!(playlist == null)) {
                            return track.addTrackToPlaylist(playlist);
                        }
                        return false;
                    }
                    for (Playlist playlist : this.playlistsCollection) {
                        if (playlist.getPlayListName().equals(playlistName)) {
                            return track.addTrackToPlaylist(playlist);
                        }
                    }
                    break;
                case "Add to Favorites":
                    for (Playlist playlist : this.playlistsCollection) {
                        if (playlist.getPlayListName().equals("Favorites")) {
                            return track.addTrackToPlaylist(playlist);
                        }
                    }
                    break;
            }
        }
        return false;
    }

    public boolean operationsOnTrack() {
        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
        String[] options = {"Display Tracks", "Play Track", "Rename track", "Remove Track"};
        String response = (String) JOptionPane.showInputDialog(null,
                "Select operation to perform on Tracks : ",
                "WaveFX",
                JOptionPane.INFORMATION_MESSAGE,
                icon,
                options,
                null);
        if (!(response == null)) {
            switch (response) {
                case "Display Tracks":
                    return this.displayAvailableTracks();
                case "Play Tracks":
                    return this.playTracksSequentially();
                case "Rename Tracks":
                    return this.renameTrack();
                case "Remove Tracks":
                    return this.removeTracks();
            }
        }
        return false;
    }

//    public boolean operationsOnAlbum() {
//        Icon icon = new ImageIcon("src/Exploit/org/Trackstore/WaveFX.png");
//        String [] options = {"Display Albums"};
//        String response = (String) JOptionPane.showInputDialog(null,
//                "Select operation to perform on Albums : ",
//                "WaveFX",
//                JOptionPane.INFORMATION_MESSAGE,
//                icon,
//                options,
//                null);
//        if (!(response == null)) {
//            if (response.equals("Display Albums")) {
//                return this.displayAvailableAlbums();
//            }
//        }
//        return false;
//    }
}
